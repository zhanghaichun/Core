<!DOCTYPE html>
<!--
BeyondAdmin - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.2.0
Version: 1.0.0
Purchase: http://wrapbootstrap.com
-->

<html xmlns="http://www.w3.org/1999/xhtml">
<!-- Head -->
<head>
    <meta charset="utf-8" />
    <title>追加订单</title>

    <meta name="description" content="Dashboard" />
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="shortcut icon" href="../../assets/img/favicon.png" type="image/x-icon">


    <!--Basic Styles-->
    <link href="../../assets/css/bootstrap.min.css" rel="stylesheet" />
    <link id="bootstrap-rtl-link" href="" rel="stylesheet" />
    <link href="../../assets/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../../assets/css/weather-icons.min.css" rel="stylesheet" />

    <!--Fonts-->
    <!--<link href="http://fonts.useso.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300" rel="stylesheet" type="text/css">-->

    <!--Beyond styles-->
    <link href="../../assets/css/beyond.min.css" rel="stylesheet" type="text/css" />
    <link href="../../assets/css/demo.min.css" rel="stylesheet" />
    <link href="../../assets/css/typicons.min.css" rel="stylesheet" />
    <link href="../../assets/css/animate.min.css" rel="stylesheet" />
    <link id="skin-link" href="" rel="stylesheet" type="text/css" />

    <!--Skin Script: Place this script in head to load scripts for skins and rtl support-->
    <script src="../../assets/js/skins.min.js"></script>
    <style>
        .main-container{margin-top: 45px;}
        .navbar.bottomSlider{height: 45px!important;width: 100%;position: fixed;z-index: 99999;top:0px;}
        .navbar .sidebar-collapse{left: auto;right: 5px;}
        .back{font-size: 40px;padding-left: 10px;width: 60px;}
        .navbar .sidebar-collapse:hover{-webkit-box-shadow:none;box-shadow:none}
        .widget,.widget-body{box-shadow: none}
        .submit{width: 100%}
        .navbar .sidebar-collapse{width: 100px;line-height: 45px;font-size: 18px;color: #ffffff;position: absolute;left: 50%;margin-left: -50px;}
        .col-xs-6{height: 30px;line-height: 30px;padding: 0px 20px;font-size: 16px;}
        #myModal .modal-dialog{position: absolute;top: 20%;width: 95%;}
        #myModal .modal-dialog p{margin-bottom: 0px;}
        #myModal button{width: 100%;background: #57b5e3;color: #ffffff;font-size: 20px;}
        #edit .modal-dialog{position: absolute;top: 50%;margin-top: -125px;width:calc(100% - 20px);}
        #edit .modal-content{height: 300px;}
        #edit .modal-body{height:250px;overflow: scroll}
        .f20{font-size: 20px;}
        .form-group label{color: #428bca}
        .lock{
            position: fixed;
            z-index: 1;
        }
        .widget{margin: 3px 0 0px 0;}
        .orders-container .orders-list .order-item:hover:before{display: none}
        #edit .btn{width: 100%;}
        .add{width: 50px;position: absolute;top: 132px;right: 15px;text-align: right;}
        .glyphicon-plus{color: #FD171B;}
        .form-group{margin-bottom: 10px;}
        .type{margin-left: 40px;}
        .half{width: 50%;float: left}
    </style>

</head>
<!-- /Head -->
<!-- Body -->
<body>
<!-- Loading Container -->
<div class="loading-container">
    <div class="loading-progress">
        <div class="rotator">
            <div class="rotator">
                <div class="rotator colored">
                    <div class="rotator">
                        <div class="rotator colored">
                            <div class="rotator colored"></div>
                            <div class="rotator"></div>
                        </div>
                        <div class="rotator colored"></div>
                    </div>
                    <div class="rotator"></div>
                </div>
                <div class="rotator"></div>
            </div>
            <div class="rotator"></div>
        </div>
        <div class="rotator"></div>
    </div>
</div>
<!--  /Loading Container -->
    <!-- Navbar -->
    <div class="navbar bottomSlider">
        <div class="navbar-inner">
            <div class="navbar-container">
                <div class="navbar-header pull-left">
                    <a href="../Index/index" class="navbar-brand">
                        <small>
                            <i class="fa fa-angle-left back"></i>
                        </small>
                    </a>
                </div>
                <!-- Sidebar Collapse -->
                <div class="sidebar-collapse" id="sign">追加订单</div>
                <!-- /Sidebar Collapse -->
            </div>
        </div>
    </div>
    <!-- /Navbar -->
    <!-- Main Container -->
    <div class="main-container container-fluid">
        <!-- Page Container -->
        <div class="widget">
            <div class="widget-body">
                <div>
                    <div class="form-group">
                        <label for="phone">手机号</label>
                        <input type="text" class="form-control" id="phone" placeholder="请输入用户手机号码" value="<%= mobile%>" <% if(mobile != ''){%>disabled="true"<%}%>>
                    </div>
                    <div class="form-group ">
                        <label>产品选择</label>
                        <div class="add"><i class="glyphicon glyphicon-plus"></i></div>
                        <div class="orders-container">
                            <ul class="orders-list">
                                <% if(product != ''){ var  productList = product.split(";")%>
                                <% for(var i=0; i<productList.length-1; i++){ var itemList= productList[i].split(",")%>
                                <li class="order-item" pid="<%= itemList[0]%>">
                                    <a href="javascript:void(0)">
                                        <div class="row">
                                            <div class="col-xs-6 text-left"><%= itemList[1]%></div>
                                            <div class="col-xs-6 text-right"><%= itemList[2]%></div>
                                        </div>
                                    </a>
                                </li>
                                <%}%>
                                <%}%>
                            </ul>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-blue submit">生成订单</button>
                </div>
            </div>
        </div>

    </div>

    <!--Basic Scripts-->
    <script src="../../assets/js/jquery-2.0.3.min.js"></script>
    <script src="../../assets/js/bootstrap.min.js"></script>

    <!--Beyond Scripts-->
    <script src="../../assets/js/beyond.min.js"></script>
    <script>
        var mobile ="<%= mobile%>";
        var product ="<%= product%>"
        $(function(){
            $(".add").click(function(){
               if(!/^1\d{10}$/.test($.trim($("#phone").val()))){
                   $("#myModal .f20").html('请输入正确手机号码');
                   $("#myModal").modal();
               }else{
                   var param = {mobile:$.trim($("#phone").val())}
                   $(".loading-container").css('display','block');
                   $(".loading-progress").css('display','block');
                   $.post('../Add/confirmAdd',param, function (data){
                        if(data.isSuccess){
                            window.location.href = '../Add/product?mobile='+$.trim($("#phone").val());
                        }else{
                            $("#myModal .f20").html(data.errors[0]);
                            $("#myModal").modal();
                        }
                       $(".loading-container").css('display','none');
                       $(".loading-progress").css('display','none');
                   })
               }

            })
            $('.submit').click(function(){
                if(mobile == '' && $.trim($("#phone").val()) == ''){
                    $("#myModal .f20").html("请先输入手机号");
                    $("#myModal").modal();
                }else if(product == ''){
                    $("#myModal .f20").html("请先选择产品");
                    $("#myModal").modal();
                }else{
                    var pidList = '';
                    var productItem = '';
                    var productList = product.split(";");
                    for(var i=0; i<productList.length-1; i++){
                        var itemList = productList[i].split(",");
                        pidList = pidList + itemList[0] +',';
                        productItem = productItem +'<div class="item-store"><div class="half">'+itemList[1]+'('+itemList[2]+')</div><div class="half">类别：'+itemList[3] +'</div></div>'
                    }
                    pidList = pidList.substring(0,pidList.length-1);
                    var  param = {mobile : mobile};
                    $(".loading-container").css('display','block');
                    $(".loading-progress").css('display','block');
                    $.post('/Add/getInfo',param, function (data) {
                        $("#edit .time div").html(data.orderDate);
                        $("#edit .sty div").html(data.stylistName);
                        $("#edit .user div").html(data.userName);
                        $("#edit .product div").remove();
                        $("#edit .product").append(productItem);
                        $(".loading-container").css('display','none');
                        $(".loading-progress").css('display','none');
                        $("#edit").modal();
                        $('.container-fluid').css('top','-'+window.pageYOffset+'px');
                        offsetTop = window.pageYOffset;
                        $('.container-fluid').addClass('lock');
                        $("#edit .close").unbind();
                        $("#edit .close").click(function(){
                            $('.container-fluid').removeClass('lock');
                            $('body').scrollTop(offsetTop);
                            offsetTop = 0;
                            $("#edit").modal('hide');
                        })
                        $('#edit .modal-footer .btn').unbind();
                        $('#edit .modal-footer .btn').click(function(){
                            var  param = {mobile : mobile,productIds: pidList};
                            $.post('/Add/order',param, function (data) {
                                if(data.isSuccess){
                                    $('.container-fluid').removeClass('lock');
                                    $('body').scrollTop(offsetTop);
                                    offsetTop = 0;
                                    $("#edit").modal('hide');
                                    $("#myModal .f20").html("追加订单成功");
                                    $("#myModal").modal();
                                }else{
                                    $("#myModal .f20").html(data.errors[0]);
                                    $("#myModal").modal();
                                }
                            })
                        })
                    })
                }
            })
        })
    </script>
    <div id="myModal" class="modal modal-darkorange">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <p class="f20"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">确 定</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <div id="edit" class="modal modal-darkorange">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" aria-hidden="true">×</button>
                    <h4 class="modal-title">订单详情</h4>
                </div>
                <div class="modal-body">
                    <div class="widget">
                        <div class="widget-body">
                            <div>
                                <div class="form-group user">
                                    <label>订单用户</label>
                                    <div class="item-store"></div>
                                </div>
                                <div class="form-group time">
                                    <label>订单日期</label>
                                    <div class="item-time"></div>
                                </div>
                                <div class="form-group sty">
                                    <label>设计师</label>
                                    <div class="item-time"></div>
                                </div>
                                <div class="form-group product">
                                    <label>产品信息</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-blue">确认</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
</body>
<!--  /Body -->
</html>
